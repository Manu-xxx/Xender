package com.hedera.services.config;

import com.hedera.test.extensions.LogCaptor;
import com.hedera.test.extensions.LogCaptureExtension;
import com.hedera.test.extensions.LoggingSubject;
import com.hedera.test.extensions.LoggingTarget;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;

import static org.junit.jupiter.api.Assertions.assertEquals;

@ExtendWith({ LogCaptureExtension.class })
class Log4JExploitTest {
	@LoggingTarget
	private LogCaptor logCaptor;

	@LoggingSubject
	private TestClassWithLogger subject = new TestClassWithLogger();

	// toggle the no look up pattern by un/commenting the following boolean.
	private Boolean noLookUpExploit;

	@Test
	void testLog4jExploit() {
		final var malUri = "${jndi:https://previewnet.mirrornode.hedera.com/api/v1/accounts?account.id=0.0.90}";
		final var expectedLog = "Weâ€™re doomed. " + malUri;
		subject.testLogger(malUri);

		final var logs = logCaptor.warnLogs();

		assertEquals(1, logs.size());
		assertEquals(expectedLog, logs.get(0));
	}
}
